
					ListviewAdapter.java
package developer.tuyen.test; 
import android.content.Context; 
import android.support.annotation.NonNull; 
import android.support.annotation.Nullable; 
import android.view.View; 
import android.view.ViewGroup; 
import android.widget.ArrayAdapter; 
import android.widget.TextView; 
import java.util.ArrayList; 
public class ListviewAdapter extends ArrayAdapter { 
    Context context; 
    ArrayList<String> list; 
    public ListviewAdapter(@NonNull Context context, int resource, @NonNull ArrayList<String> objects) { 
        super(context, resource, objects); 
        this.context=context; 
        this.list=objects; 
    } 
    @NonNull 
    @Override 
    public View getView(int position, @Nullable View convertView, @NonNull ViewGroup parent) { 
        if (list.get(position).equals("0")){ 
            convertView=View.inflate(context,R.layout.layout_adater_item_loadingprogressbar,null); 
        }else{ 
            convertView=View.inflate(context,R.layout.layout_adapter_item,null); 
            TextView textView=convertView.findViewById(R.id.textView2); 
            textView.setText(list.get(position)); 
        } 
        return convertView; 
    } 
 
    public ArrayList<String> getList() { 
        return list; 
    } 
 
    public void setList(ArrayList<String> list) { 
        this.list = list; 
    } 
} 

						MainActivity.java
package developer.tuyen.test; 
import android.os.AsyncTask; 
import android.support.v7.app.AppCompatActivity; 
import android.os.Bundle; 
import android.util.Log; 
import android.view.View; 
import android.widget.Button; 
import android.widget.ListView; 
import android.widget.ProgressBar; 
import android.widget.Toast; 
import java.util.ArrayList; 
 
public class MainActivity extends AppCompatActivity { 
    ListView listView; 
    ArrayList<String> list=new ArrayList<>(); 
    ListviewAdapter listviewAdapter; 
    Button button; 
    MyAsynk myAsynk; 
    ProgressBar progressBar; 
    @Override 
    protected void onCreate(Bundle savedInstanceState) { 
        super.onCreate(savedInstanceState); 
        setContentView(R.layout.activity_main); 
        progressBar=findViewById(R.id.progressBar); 
        progressBar.setProgress(0); 
        listView=findViewById(R.id.listview); 
        listviewAdapter=new ListviewAdapter(this,0,list); 
        listView.setAdapter(listviewAdapter); 
        listviewAdapter.notifyDataSetChanged(); 
        button=findViewById(R.id.button); 
        button.setOnClickListener(new View.OnClickListener() { 
            @Override 
            public void onClick(View v) { 
                if (myAsynk!=null){ 
                    if (myAsynk.isCancelled()){ 
                        createSomeTask(); 
                    }else{ 
                        Toast.makeText(MainActivity.this, "Task is running!", Toast.LENGTH_SHORT).show(); 
                    } 
                }else{ 
                    createSomeTask(); 
                } 
            } 
        }); 
 
    } 
 
    @Override 
    protected void onResume() { 
        super.onResume(); 
 
    } 
    private void createSomeTask(){ 
        myAsynk=new MyAsynk(); 
        myAsynk.execute(new Integer[]{1,24,5215,125216}); 
    } 
    private class MyAsynk extends AsyncTask<Integer,Double,ArrayList<Integer>>{ 
        @Override 
        protected void onPreExecute() { 
            super.onPreExecute(); 
            //indicate that data is loading with a progress bar. 
            list.add("0"); 
            listviewAdapter.notifyDataSetChanged(); 
        } 
 
        @Override 
        protected ArrayList<Integer> doInBackground(Integer... integers) { 
            ArrayList<Integer> arrayList=new ArrayList<>(); 
            //for i reach each mission in the inputed array and do something. 
            int progressPercent=0; 
            for (int i:integers){ 
                progressPercent+=100/integers.length; 
                try { 
                    Thread.sleep(1000); 
                    publishProgress((double) progressPercent); 
                    arrayList.add(i); 
                } catch (InterruptedException e) { 
                    e.printStackTrace(); 
                } 
            } 
 
            return arrayList; 
        } 
 
        @Override 
        protected void onProgressUpdate(Double... values) { 
            super.onProgressUpdate(values); 
            //Update inteface: listview 
            progressBar.setProgress((int) values[0].doubleValue()); 
        } 
        @Override 
        protected void onPostExecute( ArrayList<Integer> integers) { 
            super.onPostExecute(integers); 
            list.remove("0"); 
            for (Integer integer:integers){ 
                list.add(String.valueOf(integer)); 
            } 
            Log.i("progress",list.toString()); 
            //Rememberto call method notifyDatasetChange 
            listviewAdapter.notifyDataSetChanged(); 
            //cancel asyntask after final tasks. 
            cancel(true); 
        } 
    } 
} 